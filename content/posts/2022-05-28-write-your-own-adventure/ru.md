---
title = "Write Your Own Adventure"
tags = [ "the-tale", "gamedev", "game-designe", "neural-networks", "procedural-content-generation", "theory", "futurology", "interesting"]
published_at = "2022-05-28T12:00:00+00:00"
description = "Описание гипотетического нового жанра игр, который может появиться с расцветом нейронных сетей."
seo_image = ""
---

Я уже публиковал [концепт документы игр]{tags:concepts}. В этот раз будет не концепт, a скорее [white paper](https://en.wikipedia.org/wiki/White_paper) игр нового поджанра. Несколько его представителей уже есть, со временем их будет становиться больше.

О чём-то похожем я уже говорил, когда писал про [будущее контента в геймдеве]{post:future-of-content-in-gamedev}.

Write Your Own Adventure — WYOA — по аналогии с [Choose Your Own Adventure](https://en.wikipedia.org/wiki/Choose_Your_Own_Adventure) — CYOA.

В WYOA игрок не ограничен небольшим количеством предопределённых вариантов действий, как приходится делать в CYOA из-за сложности поддержки дерева сюжета. Количество выборов будет либо очень большим либо бесконечным. Благодаря нейронным сетям, конечно, но о них позже.

<!-- more -->

В остальном жанры схожи — отличие больше в технологиях, чем в механиках, поэтому пока и считаю WYOA поджанром CYOA.

Текущие представители:

- [AI Dungeon](https://play.aidungeon.io/main/home) - первая ласточка, появилась в 2019 как прототип и с тех пор постепенно развивается.
- [Gamio AI](https://habr.com/ru/post/665764/) - русскоязычная поделка, может быть разовьётся во что-то интересное.

Думаю, на гитхабе найдётся ещё десяток прототипов.

Ключевой геймплей WYOA можно описать следующим образом:

1. Игра описывает игроку текущую ситуацию в более-менее художественном стиле: текстом, картинками.
2. Игрок выбирает действие из списка предложенных или вводит своё описание.
3. Игра применяет выбор игрока к состоянию мира и делает шаг моделирования игровой ситуации.
4. go to пункт 1.

Пункт 3 является ещё одним отличием от CYOA. В CYOA обычно моделирования нет или оно условное. В основном игрок передвигается по предопределённому дереву или [DAG](https://en.wikipedia.org/wiki/Directed_acyclic_graph)\-у истории. В случае же WYOA скорее всего будет использоваться именно моделирование.

## Текущие реализации

С появлением нейронных сетей для генерации текста, естественным стало попробовать их в качестве помощников писателей или, что интереснее, в качестве Automatic Dungeon Master — ADM. ADM, в теории, мог бы подстраиваться под игрока и создавать описания игровых сцен налету.

Насколько я представляю ситуацию, экспериментов было много, но публично доступно только небольшое их количество. Скорее всего потому, что тренировать сети для генерации текста дорого, а результаты получаются не очень.

Но как минимум один из экспериментов — AI Dungeon — завершился относительно удачно и продемонстрировал принципиальную возможность создания ADM. Соответственно, сейчас дело за временем и технологиями.

Насколько я вижу по внешним признакам и понимаю предметную область, текущие попытки создания ADM используют максимально прямолиненый подход:

- (до)обучается сеть, которая умеет продолжать введённый текст;
- игрок вводит текст руками;
- сеть его продолжает;
- ???
- профит.

Проблема в том, что даже топовые сетки всё ещё генерируют посредственный текст, а чаще — плохой. Особенно это заметно на длинных текстах, в которые превращается любая игровая сессия. Нейронки (пока) плохо оперируют сложным контекстом.

Поэтому прогресс в жанре символический и без изменения подхода получить серьёзные результаты в ближайшее время не получится.

## Перевод вместо продолжения

Кроме генерации текста есть направления развития сетей с более заметным прогрессом — переводы.

Для нужд эссе будем говорить о переводах в широком смысле:

- между естественными языками;
- с естественных языков на искусственные: [Github CoPilot](https://copilot.github.com/), [генерация документации и комментариев по коду](https://marketplace.visualstudio.com/items?itemName=mintlify.document) — и обратно;
- между разными видами текста на одном языке, например, полным/художественным и аннотацией/кратким.

Чем точнее и уже очерчена область задач, тем лучше сеть можно обучить.

Соответственно, вместо тренировки моделей для генерации сложного текста как продолжения такого же сложного текста, мы можем настроить цепочку переводов между близкими, но не тождественными языками.

С одной стороны будет красивый естественный язык, с другой — машинный [DSL](https://en.wikipedia.org/wiki/Domain-specific_language), с которым можно работать классическими алгоритмами.

В качестве DSL может выступать:

- Описание состояния игры на очень упрощённом английском, как в большинстве текстовых рогаликов.
- Техническое описание с использованием языка логического программирования вроде Prolog.
- Язык математической логики: предикаты, etc.
- Что либо ещё — поле для экспериментов велико.

## DSL

Описанием ситуации на DSL мы можем манипулировать с помощью классических алгоритмов. Это задача не элементарная, но и не rocket science.

Под манипулированием я предполагаю:

- трансляция текущей игровой ситуации из внутреннего представления в DSL.
- трансляция из DSL команд во внутреннее представление игровой ситуации.

В некотором роде, таким занимаются все разработчики игр. Особенно разработчики [roguelike](https://en.wikipedia.org/wiki/Roguelike) — у них часто DSL представлен в наиболее классическом варианте — текстовом.

В [Сказке](http://the-tale.org/) по схожему принципу формируются исходные данные для текстового описания действий героя. Отличие в том, что в Сказке используется умный, но классический, [шаблонизатор](https://github.com/the-tale/utg), а не нейронка.

Контроль над описанием и изменением состояния даёт много преимуществ:

- Генерация логически непротиворечивых состояний и вариантов развития событий с учётом историчности. А это самая значимая проблема текущих реализаций WYOA.
- Формальная верификация состояния мира.
- Точное, краткое, [ортогональное](https://ru.wikibooks.org/wiki/%D0%A1%D0%BB%D0%BE%D0%B2%D0%B0%D1%80%D0%B8%D0%BA_%D1%84%D0%B8%D0%BB%D0%BE%D1%81%D0%BE%D1%84%D1%81%D1%82%D0%B2%D1%83%D1%8E%D1%89%D0%B5%D0%B3%D0%BE_%D0%B8%D0%BD%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%82%D0%B8%D0%BA%D0%B0/%D0%9E%D1%80%D1%82%D0%BE%D0%B3%D0%BE%D0%BD%D0%B0%D0%BB%D1%8C%D0%BD%D0%BE%D1%81%D1%82%D1%8C), описание контекста для каждой ситуации. Важно для всех моделей ML.
- Возможность внедрять игровые механики классическими способами, независимо от сложности механик.
- Быстрая скорость моделирования: как промотки времени, так и генерации вариантов действий для игрока.

## Возможная реализация

Разделим игровой движок на два слоя:

- Ядро движка оперирует классической игровой логикой: NPC, правила перемещения, боя, etc.
- Нейронный слой преобразует данные между техническим представлением для ядра и художественным для игрока.

Тогда:

- Ядро описывает текущую игровую ситуацию на DSL.
- Ядро генерирует несколько вариантов действий для ситуации и описывает их на том же DSL.
- Нейронный слой переводит DSL в художественное описание ситуации и художественное же описание вариантов действий.
- Игрок выбирает один из вариантов.
- Ядро знает какие конкретно изменения надо произвести для выбранного варианта и корректно их применяет.
- Возвращаемся к пункту 1.

С ядром, я думаю, всё ясно. По крайней мере для разработчиков игр :-)

### Нейронный слой

Так как нейронные сети хорошо показывают себе в [переносе признаков]{post:feature-programming}, имеет смысл не делать одну сеть для сложного перевода, а готовить цепочку специализированных сетей, каждая из которых делает кусочек работы.

Путь от DSL к красивому тексту может выглядеть так:

- Классические алгоритмы формируют описание ситуации на DSL. Например, в виде предикатов `сломано(герой, правая рука)` или в виде очень сухого английского.
- Сеть А по DSL строит текст на очень простом сухом языке.
- Сеть Б насыщает сухой текст эпитетами.
- Сеть В стилизует текст под конкретного автора. Например, под [Толкина](https://ru.wikipedia.org/wiki/%D0%A2%D0%BE%D0%BB%D0%BA%D0%B8%D0%BD,_%D0%94%D0%B6%D0%BE%D0%BD_%D0%A0%D0%BE%D0%BD%D0%B0%D0%BB%D1%8C%D0%B4_%D0%A0%D1%83%D1%8D%D0%BB) или [Сюзанну Кларк]{post:susanna-clarke-books}.
- Сеть Г правит текст, чтобы он согласовывался с предыдущим.

Каждая из сетей занимается переводом/трансформацией текста между соседними доменами, а значит их будет проще (до)обучать.

Структура нейронного слоя может быть сложнее:

- Иметь больше промежуточных или специализированных сетей. Например, отдельную сеть для генерации диалогов или сеть для фильтрации контента (сексуального, оскорбительного, etc).
- Поддерживать обратное преобразование: из текста в команды на DSL, которые будут применяться движком игры к текущей ситуации.
- По DSL можно генерировать не только текст, но и иллюстрации. Из корпораций это умеют уже все по-моему, вот [гугл недавно подтянулся](https://imagen.research.google/). Nvidia умеет даже [генерировать изображения по грубому наброску](https://www.nvidia.com/en-us/studio/canvas/). А сгенерировать грубый технический эскиз исходя из конкретной игровой ситуации не составляет принципиальных проблем.

## Риски

Без рисков, конечно, никуда. Иначе ниша уже была бы занята.

1. Разработка технологии всё ещё может оказаться слишком дорогим удовольствием.
2. Может потребоваться слишком много времени на эксперименты:
    2.1. Для выбора оптимального DSL.
    2.2. Для выбора оптимального уровня абстракций описания игровой ситуации.
    2.3. Для формирования оптимального набора сетей.
    2.4. Геймдизайн ещё под всё это надо подогнать.
3. Текст, скорее всего, в первых версиях сможет быть только англоязычным и несерьёзным. Соответственно, другие рынки будут либо закрыты либо на них уйдёт менее качественный продукт — придётся добавить ещё одну сеть для перевода на сторонние языки.
4. Аппаратное обеспечение всё ещё может быть не готово, чтобы быстро и дёшево гонять цепочку сетей для достаточно качественной и быстрой генерации.

Купировать часть рисков можно сократив фронт работ:

- Вместо разработки DSL и игровой логики выбрать готовую [roguelike](https://en.wikipedia.org/wiki/Roguelike) игру, например, [Dwarf Fortress](https://en.wikipedia.org/wiki/Dwarf_Fortress) и заниматься только нейронными сетями.
- Сосредоточиться на разработке ядра движка, заточенного под детальное описание состояния мира в DSL, и ждать, пока в соседних областях появятся необходимые технологии.
