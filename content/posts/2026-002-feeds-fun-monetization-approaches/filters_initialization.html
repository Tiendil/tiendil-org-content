<script type="text/javascript">

function fillFilters() {
    var index = 0;

    var selects = document.querySelectorAll('.plot-filter-margin');

    for (var select of selects) {

        select.id = 'plot-filter-' + index;
        index++;

        for (var margin of marginLevels) {
            var option = document.createElement('option');
            option.value = margin.id;
            option.text = margin.name;
            select.appendChild(option);
        }
    }
}

fillFilters();

function bindConfigInputs() {
    var inputs = document.querySelectorAll('.plot-config-input');

    for (var input of inputs) {
        var key = input.dataset.configKey;
        var valueType = input.dataset.valueType || 'float';

        if (!key || !(key in modelConfig)) {
            continue;
        }

        input.value = modelConfig[key];

        input.addEventListener('input', function(event) {
            var element = event.target;
            var elementKey = element.dataset.configKey;
            var elementType = element.dataset.valueType || 'float';
            var rawValue = element.value;

            var parsedValue = null;

            if (elementType === 'int') {
                parsedValue = parseInt(rawValue, 10);
            } else {
                parsedValue = parseFloat(rawValue);
            }

            if (Number.isNaN(parsedValue)) {
                return;
            }

            modelConfig[elementKey] = parsedValue;
            rebuildModelData();
        });
    }
}

bindConfigInputs();

document.dispatchEvent(redrawPlots);

</script>
